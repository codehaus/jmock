<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
      "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Mocking Classes with CGLIB</title>
</head>

<body>
<h1>Mocking Classes with jMock and the Objenesis Imposteriser</h1>

<p>Because it uses Java's standard reflection capability, the default
configuration of the jMock framework can only mock interfaces, not classes.
(Actually, we consider that to be a good thing because it encourages the
design to focus on communication between objects rather than classification
or data storage). However, the extension class
<code>jmock.lib.objenesis.ObjenesisImposteriser</code> uses the <a
href="http://cglib.sourceforge.net">CGLIB 2.1</a> and <a
href="http://code.google.com/p/objenesis/">Objenesis</a> libraries to create
mock objects of classes as well as interfaces.</p>

<p class="Note Warning">This functionality is currently only in CVS. If you
want to use it you must <a href="repository.html">check the jMock source out
of CVS</a> and build the JAR with the Ant build-file.</p>

<p>To use the ObjenesisImposteriser:</p>
<ol>
  <li>Add jmock-objenesis-2.0.0.jar, cglib-nodep-2.1_3.jar and
    objenesis-1.0.jar to your CLASSPATH.</li>
  <li>In your tests, plug the <code>ObjenesisImposteriser</code> into the
    Mockery: 
    <pre class="Source Java">import org.jmock.Mockery;
import org.jmock.Expectations;
import org.jmock.lib.objenesis.ObjenesisImposteriser;

public class ConcreteClassTest extends TestCase {
    private Mockery context = new Mockery() {{
        setImposteriser(ObjenesisImposteriser.INSTANCE);
    }};
    
    ...
}</pre>
  </li>
  <li>Your tests can now create mocks of abstract or even concrete classes: 
    <pre class="Source Java">Graphics g = context.mock(java.awt.Graphics.class);</pre>
  </li>
</ol>
</body>
</html>
